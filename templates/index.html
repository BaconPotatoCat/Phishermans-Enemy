<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Previous Websites</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script>
google.charts.load('current', {'packages': ['table']});
google.charts.setOnLoadCallback("drawTable");
function drawtable(tdata)
{
    dtable = new google.visualization.DataTable();
    dtable.addColumn("string","URL");
    for(var i = 0;i < tdata.length; i++)
    {
        url = tdata[i];
        dtable.addRows([[url]]);
    }
    table = new google.visualization.Table(document.getElementById("result"));
    table.draw(dtable, {showRowNumber: true, width: "100%", height: "100%", allowHtml: true, page: "enable"});
    
    google.visualization.events.addListener(table, "select", detailed);
}
function drawdetailed(tdata)
{
    detable = new google.visualization.DataTable();
    detable.addColumn("string","Website Details");
    detable.addColumn("string","Result");
    console.log(tdata)
    url = tdata[0];
    long = tdata[1];
    short = tdata[2];
    redirect = tdata[3];
    prefix = tdata[4];
    sub = tdata[5];
    https = tdata[6];
    request = tdata[7];
    anchor = tdata[8];
    sfh = tdata[9];
    sbc = tdata[10];
    age = tdata[11];
    traffic = tdata[12];
    model = tdata[13];
    pred = tdata[14];
    
    detable.addRows([["URL",tdata[0]]]);
    detable.addRows([["LongURL",String(tdata[1])]]);
    detable.addRows([["ShortURL",String(tdata[2])]]);
    detable.addRows([["Redirecting",String(tdata[3])]]);
    detable.addRows([["PrefixSuffix",String(tdata[4])]]);
    detable.addRows([["SubDomains",String(tdata[5])]]);
    detable.addRows([["HTTPS",String(tdata[6])]]);
    detable.addRows([["RequestURL",String(tdata[7])]]);
    detable.addRows([["AnchorURL",String(tdata[8])]]);
    detable.addRows([["ServerFormHandler",String(tdata[9])]]);
    detable.addRows([["StatusBarCust",String(tdata[10])]]);
    detable.addRows([["AgeofDomain",String(tdata[11])]]);
    detable.addRows([["WebsiteTraffic",String(tdata[12])]]);
    detable.addRows([["Model",String(tdata[13])]]);
    detable.addRows([["Prediction",String(tdata[14])]]);
    detailedtable = new google.visualization.Table(document.getElementById("detailed"));
    detailedtable.draw(detable, {showRowNumber: true, width: "100%", height: "100%", allowHtml: true});
}
function detailed(){
    var selection = table.getSelection();
    for (var i = 0; i < selection.length; i++)
    {
        var item = selection[i]
        val = dtable.getFormattedValue(item.row,0)
    }
    $.ajax({
        url:"/detailed",
        method:"POST",
        data:{row:val},
        success:function(data)
        {
            drawdetailed(data);
        }
    });
}
$(document).ready(function(){
    function load_data(query)
    {
        $.ajax({
            url:"/livesearch",
            method:"POST",
            data:{query:query},
            success:function(data)
            {
                drawtable(data);
            }
        });
    }
    load_data();
    $("#search_input").keyup(function(){
        var search = $(this).val();
        if(search != "")
        {
            load_data(search);
        }
        else
        {
            load_data();
        }
    });
	load_data();
});
</script>
</head>
<body>

<input type="text" name="search_input" id="search_input"> 
<div id="result">
</div>
<div id="detailed">
</div>
</body>
</html>